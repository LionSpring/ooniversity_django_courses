{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}Pybursa.Студенты{% endblock %}


{% block nav_active_students %}active{% endblock %}


{% block nav_st_detail %}{% endblock %}


{% block bodyhead %}{% endblock %}


{% block content %}
	<h1>Список студентов</h1>
<div class="row">
	<div class="panel panel-primary filterable">
		<div class="panel-heading">
			<h3 class="panel-title">Список слушателей</h3>
			<div class="pull-right">
				<button class="btn btn-default btn-xs btn-filter"><span class="glyphicon glyphicon-filter"></span> Скрыть фильтр</button>
			</div>
		</div>
		<table class="table">
			<thead>
				<tr class="filters">
					<th><input type="text" class="form-control" placeholder="#"></th>
					<th><input type="text" class="form-control" placeholder="Фамилия Имя"></th>
					<th><input type="text" class="form-control" placeholder="Адрес"></th>
					<th><input type="text" class="form-control" placeholder="Skype"></th>
					<th><input type="text" class="form-control" placeholder="Курсы"></th>
				</tr>
			</thead>
			<tbody>
				<tr style="display: table-row;">
                {% for i in students %}
					<td>{{ i.id }}</td>
					<td><a href="{% url 'students:student_details' i.id %}">
                              {{ i.surname}} {{ i.name}}
                        </a></td>
					<td>{{ i.address }}</td>
					<td>{{ i.skype|default:"нет" }}</td>
					<td>
                       {% for k in i.courseset %}
                       <p><a href="{% url 'courses:lessons' k.id %}">{{ k.name }}</a></p>
                       {% endfor %}
                    </td>
				</tr>
                {% endfor %}
			</tbody>
		</table>
	</div>
</div>
<div class="clear"></div>
<script type="text/javascript">
	$(document).ready(function(){
		$('.filterable .btn-filter').click(function(){
			var $panel = $(this).parents('.filterable'),
			$filters = $panel.find('.filters input'),
			$tbody = $panel.find('.table tbody');
			if ($filters.prop('disabled') == true) {
				$filters.prop('disabled', false);
				$filters.first().focus();
			} else {
				$filters.val('').prop('disabled', true);
				$tbody.find('.no-result').remove();
				$tbody.find('tr').show();
			}
		});
		$('.filterable .filters input').keyup(function(e){
			/* Ignore tab key */
			var code = e.keyCode || e.which;
			if (code == '9') return;
			/* Useful DOM data and selectors */
			var $input = $(this),
			inputContent = $input.val().toLowerCase(),
			$panel = $input.parents('.filterable'),
			column = $panel.find('.filters th').index($input.parents('th')),
			$table = $panel.find('.table'),
			$rows = $table.find('tbody tr');
			/* Dirtiest filter function ever ;) */
			var $filteredRows = $rows.filter(function(){
				var value = $(this).find('td').eq(column).text().toLowerCase();
				return value.indexOf(inputContent) === -1;
			});
			/* Clean previous no-result if exist */
			$table.find('tbody .no-result').remove();
			/* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
			$rows.show();
			$filteredRows.hide();
			/* Prepend no-result row if all rows are filtered */
			if ($filteredRows.length === $rows.length) {
				$table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">No result found</td></tr>'));
			}
		});
	});
</script>
{% endblock content %}